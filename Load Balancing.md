# 로드 밸런싱 (Load Balancing)

서버나 장비의 부하를 분산하기 위해 사용되는 장비를 로드 밸런서라고 함.  
한 대의 서버로 부하가 집중되지 않도록 트래픽을 관리함으로써 각각의 서버가 최적의 퍼포먼스를 보이는게 목적임.

* 4계층 이상에서 동작하며 IP 주소나 4계층 정보, 애플리케이션 정보를 확인 수정하는 기능이 있음.
* 주로 웹 서버의 부하 분산에 사용됨.
* 서비스의 규모가 커질 수록 기존의 서버만으로는 원활한 서비스 동작이 불가능하므로 크게 두 가지 방법으로 나뉨.
  * 기존의 서버 성능을 확장하는 Scale-up 방식
  * 기존의 서버와 동일하거나 낮은 성능의 서버를 증설하는 Scale-out 방식

## 부하 분산

* 서비스를 단일 서버로 구성할 경우 해당 서버의 장애가 발생했을 때, 정상적인 서비스를 제공할 수 없음.  
* 따라서 하나의 서비스는 보통 두 대 이상의 서버로 구성되는데 각 서버 IP주소가 다르므로 서비스를 호출할 때는 어떤 IP로 서비스를 요청할 지 결정해야함.
* 로드 밸런서를 통해 동일한 서비스의 다수 서버를 등록하고 사용자로부터 요청이 들어오면 로드 밸런서가 받아 다수의 서버로 분산시켜 부하를 분산시킴.

## L4 로드 밸런싱

![image](https://github.com/wltnthss/Network/assets/60785586/488de9ad-3ace-4aec-a3f8-324e9042941c)

* 일반적인 로드 밸런서가 동작하는 방식임.
* TCP, UDP 정보를 기반으로 로드 밸런싱을 수행함.
* 최근 로드 밸런서는 L4, L7의 기능을 지원하지만 L7 지원 여부와 상관없이 4계층에 대한 정보로만 분산 처리하는 경우.

## L7 로드 밸런싱

![image](https://github.com/wltnthss/Network/assets/60785586/6946f3c8-cc6e-4da9-af8d-cd093d3dc1a0)

* HTTP, FTP, SMTP 와 같은 애플리케이션 프로토콜 정보를 기반으로 로드 밸런싱을 수행함.
* HTTP 헤더 정보나 URI와 같은 정보를 기반으로 프로토콜을 이해한 후 부하를 분산함.
* 이런 장비를 ADC(Application Delivery Controller)라고 부르며 프록시 역할을 수행함.

## 부하 분산 방식 기법

로드 밸런싱 기법은 여러 가지가 있음.  
서버의 능력을 고려하여 분배해야 하기 때문에, 서버의 상황에 맞춰 적절한 방법을 선택해야함.

* **라운드 로빈 방식(Round Robin Method)**
    * 서버에 들어온 요청을 순서대로 돌아가며 배정하는 방식이다.  
      클라이언트의 요청을 순서대로 분배하기 때문에 여러 대의 서버가 동일한 스펙을 갖고 있고,  
      서버와의 연결(세션)이 오래 지속되지 않는 경우에 활용하기 적합하다.
- **가중 라운드로빈 방식(Weighted Round Robin Method)**
    - 각각의 서버마다 가중치를 매기고 가중치가 높은 서버에 클라이언트 요청을 우선적으로 배분한다.  
      주로 서버의 트래픽 처리 능력이 상이한 경우 사용되는 부하 분산 방식이다.
- **IP 해시 방식(IP Hash Method)**
    - 클라이언트의 IP 주소를 특정 서버로 매핑하여 요청을 처리하는 방식이다.  
      사용자의 IP를 해싱해 로드를 분배하기 때문에 사용자가 항상 동일한 서버로 연결되는 것을 보장한다.
- **최소 연결 방식(Least Connection Method)**
    - 요청이 들어온 시점에 가장 적은 연결상태를 보이는 서버에 우선적으로 트래픽을 배분한다.  
      자주 세션이 길어지거나, 서버에 분배된 트래픽들이 일정하지 않은 경우에 적합한 방식이다.
- **최소 응답 시간 방식(Least Response Time Method)**
    - 서버의 현재 연결 상태와 응답 시간(서버에 요청을 보내고 최초 응답을 받을 때까지 소요되는 시간)을 모두 고려하여 트래픽을 배분한다.  
    가장 적은 연결 상태와 가장 짧은 응답 시간을 보이는 서버에 우선적으로 로드를 배분하는 방식이다.
